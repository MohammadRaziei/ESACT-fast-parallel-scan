<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>Permutation Matrix with D3.js</title>
  <script src="https://d3js.org/d3.v7.min.js"></script>
  <style>
    svg {
      background-color: #f2f2f2;
    }

    text {
      font-family: Arial, sans-serif;
      font-size: 12px;
      fill: #333;
    }

    rect {
      fill: turquoise;
      stroke: black;
      stroke-width: 1px;
    }

    .horizontal-line {
      stroke: #ccc;
      stroke-width: 1px;
    }

    .vertical-line {
      stroke: #ccc;
      stroke-width: 1px;
    }
  </style>
</head>
<body>

    <div>
        <input value="8" type="number" id="inputMatrix"/>
        <button onclick="onApplyBtn()"> Apply </button>
    </div>

    <br/>

  <svg id="matrix"></svg>

  <script>
    const svg = d3.select("#matrix")

    function createPermutationMatrix(indices) {
      svg.selectAll("*").remove();
      // Define the size of the matrix based on the length of indices array
      const matrixSize = indices.length;
      

      // Create the SVG container
      svg.attr("width", matrixSize * 50 + 50)
        .attr("height", matrixSize * 50 + 50);

      // Create a matrix of rectangles
      const matrix = svg.selectAll("rect")
        .data(indices)
        .enter()
        .append("rect")
        .attr("x", (d, i) => i * 50 + 50)
        .attr("y", (d) => d * 50 + 50)
        .attr("width", 50)
        .attr("height", 50);

      // Add text labels to the matrix cells
      const labels = svg.selectAll("text")
        .data(indices)
        .enter()
        .append("text")
        .attr("x", (d, i) => i * 50 + 75)
        .attr("y", (d) => d * 50 + 75)
        .attr("text-anchor", "middle")
        .attr("alignment-baseline", "middle")
        .text((i, j) => `${i},${j}`);

      // Add x-axis labels
      const xAxisLabels = svg.selectAll(".x-axis-label")
        .data(indices)
        .enter()
        .append("text")
        .attr("x", (d, i) => i * 50 + 75)
        .attr("y", 25)
        .attr("text-anchor", "middle")
        .attr("alignment-baseline", "middle")
        .text((d, i) => i);

      // Add y-axis labels
      const yAxisLabels = svg.selectAll(".y-axis-label")
        .data(indices)
        .enter()
        .append("text")
        .attr("x", 25)
        .attr("y", (d, i) => i * 50 + 75)
        .attr("text-anchor", "middle")
        .attr("alignment-baseline", "middle")
        .text((d, i) => i);

      // Add horizontal grid lines
      const horizontalLines = svg.selectAll(".horizontal-line")
        .data(indices)
        .enter()
        .append("line")
        .attr("x1", 50)
        .attr("y1", (d, i) => i * 50 + 50)
        .attr("x2", matrixSize * 50 + 50)
        .attr("y2", (d, i) => i * 50 + 50)
        .attr("class", "horizontal-line");

      // Add vertical grid lines
      const verticalLines = svg.selectAll(".vertical-line")
        .data(indices)
        .enter()
        .append("line")
        .attr("x1", (d, i) => i * 50 + 50)
        .attr("y1", 50)
        .attr("x2", (d, i) => i * 50 + 50)
        .attr("y2", matrixSize * 50 + 50)
        .attr("class", "vertical-line");
    }

    // Example usage with an array of indices


    function createIndices(n) {
            let omega = [];
            omega[0] = n - 1;

            for (let i = 0; 2 * i + 1 < n; i++) {
                omega[2 * i] = Math.floor((omega[i] + omega[0]) / 2);
                omega[2 * i + 1] = Math.floor(omega[i] / 2);
            }

            return omega;
        }

        function isPowerTwo(num){
            return Math.abs(2**Math.round(Math.log2(num)) - num) < 1e-3
        }

        const input = document.getElementById("inputMatrix");

        function onApplyBtn(){
            const numnodes = parseInt(input.value);
            if(isPowerTwo(numnodes)){
                createPermutationMatrix(createIndices(numnodes));
            } else {
                alert("Enter power of two");
            }
        }


        input.addEventListener("keypress", function (event) {
            if (event.key === "Enter") {
                event.preventDefault();
                onApplyBtn();
            }
        });

        onApplyBtn();

  </script>
</body>
</html>